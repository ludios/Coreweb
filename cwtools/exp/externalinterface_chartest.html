<!doctype html>
<html>
<head>
	<meta http-equiv="charset" content="text/html; charset=utf-8">
	<title>externalinterface_chartest</title>
	<style>
	* {
		font-family: Verdana, sans-serif;
		font-size: 13px;
	}
	body, html {
		background-color: #eee;
	}
	#log {
		white-space: pre;
	}
	</style>
</head>
<body>


<script>
{{ expandScript("""
goog.require('swfobject');
goog.require('goog.json.Serializer');
goog.require('cw.externalinterface');
""") }}
//function eval(s) {alert(s)};
</script>

<div style="white-space: pre-wrap">
Sending data from Flash->JS without full escaping looks like a total disaster.
We can't send characters 8232-8233 for because they are line breaks in some crazy language.
And when trying to send character 55296, it becomes 65532 on the JS side. The same for the next thousand or so characters.

<a href="build_Experiments.log">build log</a>
</div>

<div id="Experiments">
</div>

<div id="log">
</div>
<script>
function append(msg) {
	var textnode = document.createTextNode('[' + (+new Date/1000) + '] ' + msg);
	var br = document.createElement("br");
	var logd = document.getElementById('log');
	logd.appendChild(textnode);
	logd.appendChild(br);
}

function ser(obj) {
	return serializer.serialize(obj);
}

var serializer = new goog.json.Serializer();


append('Flash version: ' + swfobject.ua.pv);

var ob = null;

var chars = [];
var messages = [];

function giveChar(code, char) {
	realCode = char.charCodeAt(0);
	if(code != realCode) {
		messages.push('Code is '+code+' but got character with code ' + realCode);
	}
	//chars.push(char.charCodeAt(0));
}

function doneGiving() {
	for(var i=0; i < messages.length; i++) {
		append(messages[i]);
	}


//	var last = -1;
//	chars.sort(function(a,b){a > b ? 1 : -1});
//	for(var i=0, len=chars.length; i < len; i++) {
//		if(code < last) {
//			append('Less than last? position ' + i);
//		}
//		var code = chars[i];
//		if(code !== last + 1) {
//			append('Gap: '+(last+1)+' to ' + (code-1));
//		}
//		last = code;
//	}
}

function ready() {
	ob = document.getElementById('Experiments');
	ob.send_all_chars();
}

var flashvars = {'onloadcallback': 'ready'};
//var flashvars = {'onloadcallback': 'overflow'};
var params = {};
swfobject.embedSWF("Experiments.swf", "Experiments", "30", "30", "9.0.0", "expressInstall.swf", /*flashvars=*/flashvars, params); // no attributes

</script>

</body>
</html>
